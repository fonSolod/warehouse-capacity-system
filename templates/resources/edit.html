{% extends "base.html" %}
{% block content %}
<h2>Редактировать ресурс</h2>
<form method="post">
    <label>Название*:
        <input type="text" name="name" value="{{ resource[3] }}" required>
    </label>

    <label>Тип ресурса*:
        <select name="type" required onchange="updateSubtypes(this.value)" id="typeSelect">
            <option value="">— Выберите —</option>
            <option value="staff" {% if resource[1] == 'staff' %}selected{% endif %}>Персонал</option>
            <option value="equipment" {% if resource[1] == 'equipment' %}selected{% endif %}>Техника</option>
        </select>
    </label>

    <label>Подтип*:
        <select name="subtype" required id="subtypeSelect">
            <!-- Опции будут подгружены JS -->
        </select>
    </label>

    <label>Зона (опционально):
        <select name="zone_id">
            <option value="">— Не привязана —</option>
            {% for z in zones %}
                <option value="{{ z[0] }}" {% if z[0] == resource[4] %}selected{% endif %}>{{ z[1] }}</option>
            {% endfor %}
        </select>
    </label>

    <button type="submit">Сохранить</button>
    <a href="{{ url_for('resource_list') }}" class="btn">Отмена</a>
</form>

<script>
function updateSubtypes(type) {
    const select = document.getElementById('subtypeSelect');
    select.innerHTML = '<option value="">— Выберите подтип —</option>';
    let options = [];
    if (type === 'staff') {
        options = ['Приёмщик', 'Грузчик', 'Контролёр'];
    } else if (type === 'equipment') {
        options = ['Ричтрак', 'Паллетоперевозчик', 'Тележка'];
    }
    options.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s;
        if (s === '{{ resource[2] }}') opt.selected = true;
        select.appendChild(opt);
    });
}

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
    const currentType = document.getElementById('typeSelect').value;
    if (currentType) {
        updateSubtypes(currentType);
    }
});
</script>
{% endblock %}